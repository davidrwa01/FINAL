<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMART-KORAFX | AI Trading Analyst</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <style>
        :root {
            --yellow: #FFD700;
            --yellow-light: #FFE44D;
            --yellow-dark: #E6C200;
            --black: #0B0B0B;
            --black-light: #1A1A1A;
            --black-lighter: #252525;
            --white: #FFFFFF;
            --gray: #888888;
            --green: #00D26A;
            --red: #FF4757;
        }

        * {
            font-family: 'Inter', sans-serif;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        body {
            background-color: var(--black);
            color: var(--white);
        }

        .bg-black { background-color: var(--black); }
        .bg-black-light { background-color: var(--black-light); }
        .bg-black-lighter { background-color: var(--black-lighter); }
        .bg-yellow { background-color: var(--yellow); }

        .text-yellow { color: var(--yellow); }
        .text-gray { color: var(--gray); }
        .text-green { color: var(--green); }
        .text-red { color: var(--red); }

        .glow-yellow {
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3), 0 0 40px rgba(255, 215, 0, 0.1);
        }

        .glow-green {
            box-shadow: 0 0 20px rgba(0, 210, 106, 0.3);
        }

        .glow-red {
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.3);
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .upload-zone {
            border: 2px dashed var(--yellow);
            background: rgba(255, 215, 0, 0.05);
            transition: all 0.3s ease;
        }

        .upload-zone:hover, .upload-zone.dragover {
            background: rgba(255, 215, 0, 0.1);
            border-color: var(--yellow-light);
        }

        .signal-card {
            background: linear-gradient(135deg, var(--black-lighter) 0%, var(--black-light) 100%);
            border-left: 4px solid var(--yellow);
        }

        .signal-card.buy { border-left-color: var(--green); }
        .signal-card.sell { border-left-color: var(--red); }
        .signal-card.wait { border-left-color: var(--gray); }

        .stat-card {
            background: var(--black-lighter);
            border: 1px solid #333;
        }

        .loading-bar {
            width: 100%;
            height: 4px;
            background: var(--black-lighter);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--yellow), var(--yellow-light));
            animation: loading 1.5s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; margin-left: 0; }
            50% { width: 70%; margin-left: 15%; }
            100% { width: 0%; margin-left: 100%; }
        }

        .scrollbar-custom::-webkit-scrollbar {
            width: 6px;
        }

        .scrollbar-custom::-webkit-scrollbar-track {
            background: var(--black-light);
        }

        .scrollbar-custom::-webkit-scrollbar-thumb {
            background: var(--yellow);
            border-radius: 3px;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
        }

        .ocr-highlight {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid var(--yellow);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
        }

        .candle-analysis {
            display: flex;
            gap: 2px;
            align-items: flex-end;
            height: 60px;
        }

        .candle {
            width: 4px;
            border-radius: 1px;
        }

        .candle.bullish { background: var(--green); }
        .candle.bearish { background: var(--red); }

        .spinner {
            border: 3px solid var(--black-lighter);
            border-top: 3px solid var(--yellow);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-step {
            transition: all 0.3s ease;
        }

        .progress-step.active {
            background: rgba(255, 215, 0, 0.2);
        }

        .progress-step.complete {
            background: rgba(0, 210, 106, 0.2);
        }

        .text-purple-400 { color: #c084fc; }
        .text-purple-500 { color: #a855f7; }
        .text-orange-400 { color: #fb923c; }
        .text-orange-500 { color: #f97316; }
        .text-cyan-400 { color: #22d3ee; }
        .bg-purple-400 { background-color: #c084fc; }
        .bg-purple-500 { background-color: #a855f7; }
        .bg-orange-400 { background-color: #fb923c; }
        .bg-orange-500 { background-color: #f97316; }
        
        .border-purple-400 { border-color: #c084fc; }
        .border-orange-400 { border-color: #fb923c; }

        .smc-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .smc-badge.bos { background: rgba(0, 210, 106, 0.2); color: #00D26A; }
        .smc-badge.choch { background: rgba(255, 215, 0, 0.2); color: #FFD700; }
        .smc-badge.ob { background: rgba(255, 215, 0, 0.3); color: #FFD700; }
        .smc-badge.fvg { background: rgba(168, 85, 247, 0.2); color: #a855f7; }

        /* Dynamic color utilities */
        .signal-green { color: var(--green); }
        .signal-red { color: var(--red); }
        .signal-gray { color: var(--gray); }
        .bg-green-opacity { background-color: rgba(0, 210, 106, 0.2); }
        .bg-red-opacity { background-color: rgba(255, 71, 87, 0.2); }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="bg-black-light border-b border-gray-800 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2">
                        <div class="w-10 h-10 bg-yellow flex items-center justify-center rounded-lg glow-yellow">
                            <svg class="w-6 h-6 text-black" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold tracking-wide">SMART-KORAFX</h1>
                            <p class="text-xs text-gray">AI TRADING ANALYST</p>
                        </div>
                    </div>
                </div>
                
                <nav class="hidden md:flex items-center gap-6">
                    <a href="#" class="text-yellow text-sm font-medium hover:text-yellow-light transition">Dashboard</a>
                    <a href="#" class="text-gray text-sm hover:text-white transition">Analysis</a>
                    <a href="#" class="text-gray text-sm hover:text-white transition">Trade History</a>
                    <a href="#" class="text-gray text-sm hover:text-white transition">Analytics</a>
                </nav>

                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2 px-3 py-1.5 bg-black-lighter rounded-full">
                        <div class="w-2 h-2 bg-green rounded-full pulse" id="api-status"></div>
                        <span class="text-xs text-green mono" id="api-status-text">LIVE DATA</span>
                    </div>
                    <div class="w-8 h-8 bg-yellow rounded-full flex items-center justify-center text-black font-bold text-sm">
                        AI
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- Live Market Ticker - Real Data -->
        <div class="flex flex-wrap items-center gap-4 mb-6 overflow-x-auto pb-2">
            <div class="flex items-center gap-2 px-4 py-2 bg-black-light rounded-lg min-w-fit">
                <span class="text-gray text-xs">BTC/USDT</span>
                <span class="text-white mono text-sm" id="btc-price">Loading...</span>
                <span class="text-xs" id="btc-change">--</span>
            </div>
            <div class="flex items-center gap-2 px-4 py-2 bg-black-light rounded-lg min-w-fit">
                <span class="text-gray text-xs">ETH/USDT</span>
                <span class="text-white mono text-sm" id="eth-price">Loading...</span>
                <span class="text-xs" id="eth-change">--</span>
            </div>
            <div class="flex items-center gap-2 px-4 py-2 bg-black-light rounded-lg min-w-fit">
                <span class="text-gray text-xs">EUR/USD</span>
                <span class="text-white mono text-sm" id="eur-price">Loading...</span>
                <span class="text-xs" id="eur-change">--</span>
            </div>
            <div class="flex items-center gap-2 px-4 py-2 bg-black-light rounded-lg min-w-fit">
                <span class="text-gray text-xs">XAU/USD</span>
                <span class="text-yellow mono text-sm" id="gold-price">Loading...</span>
                <span class="text-xs" id="gold-change">--</span>
            </div>
            <div class="flex items-center gap-2 px-4 py-2 bg-black-light rounded-lg min-w-fit">
                <span class="text-gray text-xs">GBP/USD</span>
                <span class="text-white mono text-sm" id="gbp-price">Loading...</span>
                <span class="text-xs" id="gbp-change">--</span>
            </div>
            <div class="ml-auto text-xs text-gray flex items-center gap-2">
                <span class="mono" id="current-time"></span>
                <span class="text-yellow">|</span>
                <span id="market-session">--</span>
            </div>
        </div>

        <div class="grid lg:grid-cols-3 gap-6">
            <!-- Left Column - Upload & Analysis -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Upload Section -->
                <div class="bg-black-light rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold flex items-center gap-2">
                            <svg class="w-5 h-5 text-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            Chart Analysis Engine
                        </h2>
                        <span class="text-xs text-gray">AI-Powered Image Recognition</span>
                    </div>
                    
                    <div id="upload-zone" class="upload-zone rounded-xl p-8 text-center cursor-pointer">
                        <input type="file" id="file-input" class="hidden" accept="image/*">
                        <div id="upload-content">
                            <svg class="w-16 h-16 text-yellow mx-auto mb-4 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                            </svg>
                            <p class="text-lg font-medium mb-2">Drop your trading chart here</p>
                            <p class="text-sm text-gray mb-4">AI will analyze patterns, structure, and generate signals</p>
                            <div class="flex flex-wrap justify-center gap-2 text-xs text-gray">
                                <span class="px-2 py-1 bg-black-lighter rounded">Forex</span>
                                <span class="px-2 py-1 bg-black-lighter rounded">Crypto</span>
                                <span class="px-2 py-1 bg-black-lighter rounded">Gold</span>
                                <span class="px-2 py-1 bg-black-lighter rounded">Indices</span>
                            </div>
                        </div>
                        <div id="preview-content" class="hidden">
                            <img id="chart-preview" class="max-h-72 mx-auto rounded-lg mb-4 border border-gray-700">
                            <div class="flex items-center justify-center gap-4">
                                <p class="text-sm text-gray" id="file-name"></p>
                                <button onclick="resetUpload()" class="text-xs text-red hover:text-red-400 transition">Remove</button>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden canvas for image analysis -->
                    <canvas id="analysis-canvas" class="hidden"></canvas>
                </div>

                <!-- AI Analysis Progress -->
                <div id="analysis-panel" class="bg-black-light rounded-xl p-6 hidden">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold flex items-center gap-2">
                            <div class="spinner"></div>
                            <span>AI Analysis in Progress</span>
                        </h3>
                        <span class="text-xs text-yellow mono" id="analysis-status">Initializing...</span>
                    </div>
                    
                    <div class="loading-bar mb-4">
                        <div class="loading-progress"></div>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-xs" id="analysis-steps">
                        <div class="progress-step flex items-center gap-2 p-2 bg-black-lighter rounded" id="step-1">
                            <svg class="w-4 h-4 text-gray step-icon" fill="currentColor" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>Image Processing</span>
                        </div>
                        <div class="progress-step flex items-center gap-2 p-2 bg-black-lighter rounded" id="step-2">
                            <svg class="w-4 h-4 text-gray step-icon" fill="currentColor" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>OCR Extraction</span>
                        </div>
                        <div class="progress-step flex items-center gap-2 p-2 bg-black-lighter rounded" id="step-3">
                            <svg class="w-4 h-4 text-gray step-icon" fill="currentColor" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>Pattern Detection</span>
                        </div>
                        <div class="progress-step flex items-center gap-2 p-2 bg-black-lighter rounded" id="step-4">
                            <svg class="w-4 h-4 text-gray step-icon" fill="currentColor" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>Live Price Verify</span>
                        </div>
                        <div class="progress-step flex items-center gap-2 p-2 bg-black-lighter rounded" id="step-5">
                            <svg class="w-4 h-4 text-gray step-icon" fill="currentColor" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>Trend Analysis</span>
                        </div>
                        <div class="progress-step flex items-center gap-2 p-2 bg-black-lighter rounded" id="step-6">
                            <svg class="w-4 h-4 text-gray step-icon" fill="currentColor" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>Strategy Match</span>
                        </div>
                        <div class="progress-step flex items-center gap-2 p-2 bg-black-lighter rounded" id="step-7">
                            <svg class="w-4 h-4 text-gray step-icon" fill="currentColor" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>Risk Calculation</span>
                        </div>
                        <div class="progress-step flex items-center gap-2 p-2 bg-black-lighter rounded" id="step-8">
                            <svg class="w-4 h-4 text-gray step-icon" fill="currentColor" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>Signal Generation</span>
                        </div>
                    </div>

                    <!-- Real-time extraction display -->
                    <div id="extraction-display" class="mt-4 p-4 bg-black rounded-lg hidden">
                        <h4 class="text-xs text-yellow mb-2 font-semibold">EXTRACTED DATA</h4>
                        <div class="grid grid-cols-2 gap-2 text-xs">
                            <div><span class="text-gray">Symbol:</span> <span id="extracted-symbol" class="text-white mono">--</span></div>
                            <div><span class="text-gray">Timeframe:</span> <span id="extracted-timeframe" class="text-white mono">--</span></div>
                            <div><span class="text-gray">Chart Price:</span> <span id="extracted-price" class="text-white mono">--</span></div>
                            <div><span class="text-gray">Live Price:</span> <span id="live-price-verify" class="text-green mono">--</span></div>
                        </div>
                    </div>
                </div>

                <!-- Trade Signal Result -->
                <div id="signal-result" class="hidden">
                    <!-- Signal will be dynamically inserted here -->
                </div>

                <!-- Image Analysis Details -->
                <div id="analysis-details" class="bg-black-light rounded-xl p-6 hidden">
                    <h3 class="font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        Chart Analysis Breakdown
                    </h3>
                    
                    <div class="grid md:grid-cols-3 gap-4">
                        <!-- Color Analysis -->
                        <div class="bg-black rounded-lg p-4">
                            <h4 class="text-xs text-gray mb-3">CANDLE DISTRIBUTION</h4>
                            <div class="flex items-center gap-4 mb-2">
                                <div class="flex-1">
                                    <div class="flex justify-between text-xs mb-1">
                                        <span class="text-green">Bullish</span>
                                        <span id="bullish-pct" class="text-green mono">0%</span>
                                    </div>
                                    <div class="h-2 bg-black-lighter rounded-full overflow-hidden">
                                        <div id="bullish-bar" class="h-full bg-green transition-all duration-500" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="flex-1">
                                    <div class="flex justify-between text-xs mb-1">
                                        <span class="text-red">Bearish</span>
                                        <span id="bearish-pct" class="text-red mono">0%</span>
                                    </div>
                                    <div class="h-2 bg-black-lighter rounded-full overflow-hidden">
                                        <div id="bearish-bar" class="h-full bg-red transition-all duration-500" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- SMC Patterns -->
                        <div class="bg-black rounded-lg p-4">
                            <h4 class="text-xs text-gray mb-3">SMC STRUCTURE</h4>
                            <div id="smc-patterns" class="space-y-1 text-xs">
                                <!-- SMC patterns will be inserted here -->
                            </div>
                        </div>

                        <!-- Key Levels & Zones -->
                        <div class="bg-black rounded-lg p-4">
                            <h4 class="text-xs text-gray mb-3">KEY ZONES</h4>
                            <div id="key-levels" class="space-y-1 text-xs">
                                <!-- Levels will be inserted here -->
                            </div>
                        </div>
                    </div>

                    <!-- SMC Analysis Section -->
                    <div class="mt-4 grid md:grid-cols-2 gap-4">
                        <!-- Order Blocks -->
                        <div class="bg-black rounded-lg p-4">
                            <h4 class="text-xs text-yellow mb-3 font-semibold flex items-center gap-2">
                                <span class="w-3 h-3 bg-yellow rounded"></span>
                                ORDER BLOCKS (OB)
                            </h4>
                            <div id="order-blocks" class="space-y-2 text-xs max-h-32 overflow-y-auto scrollbar-custom">
                                <span class="text-gray">Analyzing...</span>
                            </div>
                        </div>

                        <!-- Fair Value Gaps -->
                        <div class="bg-black rounded-lg p-4">
                            <h4 class="text-xs text-yellow mb-3 font-semibold flex items-center gap-2">
                                <span class="w-3 h-3 bg-purple-500 rounded"></span>
                                FAIR VALUE GAPS (FVG)
                            </h4>
                            <div id="fair-value-gaps" class="space-y-2 text-xs max-h-32 overflow-y-auto scrollbar-custom">
                                <span class="text-gray">Analyzing...</span>
                            </div>
                        </div>
                    </div>

                    <!-- BOS/CHoCH Display -->
                    <div class="mt-4 bg-black rounded-lg p-4">
                        <h4 class="text-xs text-yellow mb-3 font-semibold">MARKET STRUCTURE SHIFTS</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="structure-shifts">
                            <div class="bg-black-lighter rounded p-3 text-center">
                                <div class="text-lg font-bold" id="bos-count">0</div>
                                <div class="text-xs text-gray">BOS Detected</div>
                            </div>
                            <div class="bg-black-lighter rounded p-3 text-center">
                                <div class="text-lg font-bold" id="choch-count">0</div>
                                <div class="text-xs text-gray">CHoCH Detected</div>
                            </div>
                            <div class="bg-black-lighter rounded p-3 text-center">
                                <div class="text-lg font-bold text-yellow" id="ob-count">0</div>
                                <div class="text-xs text-gray">Order Blocks</div>
                            </div>
                            <div class="bg-black-lighter rounded p-3 text-center">
                                <div class="text-lg font-bold text-purple-400" id="fvg-count">0</div>
                                <div class="text-xs text-gray">FVGs</div>
                            </div>
                        </div>
                        <div id="structure-narrative" class="mt-3 p-3 bg-black-lighter rounded text-xs text-gray">
                            <span class="text-yellow font-semibold">Analysis:</span> <span id="smc-narrative">Waiting for chart analysis...</span>
                        </div>
                    </div>
                </div>

                <!-- Live Chart -->
                <div class="bg-black-light rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold flex items-center gap-2">
                            <svg class="w-5 h-5 text-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/>
                            </svg>
                            Live Market Chart
                            <span class="text-xs text-green ml-2">(Real-time)</span>
                        </h2>
                        <div class="flex gap-2" id="chart-symbol-btns">
                            <button onclick="switchChartSymbol('BTCUSDT')" class="chart-btn px-3 py-1 text-xs bg-yellow text-black rounded transition" data-symbol="BTCUSDT">BTC</button>
                            <button onclick="switchChartSymbol('ETHUSDT')" class="chart-btn px-3 py-1 text-xs bg-black-lighter rounded hover:bg-yellow hover:text-black transition" data-symbol="ETHUSDT">ETH</button>
                            <button onclick="switchChartSymbol('XAUUSD')" class="chart-btn px-3 py-1 text-xs bg-black-lighter rounded hover:bg-yellow hover:text-black transition" data-symbol="XAUUSD">GOLD</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="liveChart"></canvas>
                    </div>
                    <div class="flex justify-between items-center mt-3 text-xs text-gray">
                        <span id="chart-symbol-display">BTCUSDT</span>
                        <span id="chart-last-update">Last update: --</span>
                    </div>
                </div>

                <!-- Trade History -->
                <div class="bg-black-light rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold">Analysis History</h2>
                        <span class="text-xs text-gray" id="history-count">0 analyses</span>
                    </div>
                    <div id="trade-history" class="space-y-3 scrollbar-custom max-h-64 overflow-y-auto">
                        <div class="text-center text-gray text-sm py-8">
                            No analyses yet. Upload a chart to begin.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Stats & Settings -->
            <div class="space-y-6">
                <!-- Real-time Market Data -->
                <div class="bg-black-light rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold flex items-center gap-2">
                            <svg class="w-5 h-5 text-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                            </svg>
                            Live Market Data
                        </h2>
                        <button onclick="openAddPairModal()" class="text-xs bg-yellow text-black px-2 py-1 rounded hover:bg-yellow-light transition">
                            + Add Pair
                        </button>
                    </div>
                    <div class="space-y-2 scrollbar-custom max-h-96 overflow-y-auto" id="live-markets">
                        <!-- Will be populated with real data -->
                        <div class="flex items-center justify-center py-4">
                            <div class="spinner"></div>
                            <span class="text-xs text-gray ml-2">Loading markets...</span>
                        </div>
                    </div>
                </div>

                <!-- Symbol Detection Stats -->
                <div class="bg-black-light rounded-xl p-6">
                    <h2 class="text-lg font-semibold flex items-center gap-2 mb-4">
                        <svg class="w-5 h-5 text-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        Supported Instruments
                    </h2>
                    <div class="grid grid-cols-2 gap-2 text-xs">
                        <div class="bg-black-lighter p-2 rounded text-center">
                            <div class="text-yellow font-bold">CRYPTO</div>
                            <div class="text-gray">BTC, ETH, BNB, SOL</div>
                        </div>
                        <div class="bg-black-lighter p-2 rounded text-center">
                            <div class="text-yellow font-bold">FOREX</div>
                            <div class="text-gray">EUR, GBP, JPY, CHF</div>
                        </div>
                        <div class="bg-black-lighter p-2 rounded text-center">
                            <div class="text-yellow font-bold">METALS</div>
                            <div class="text-gray">XAU, XAG</div>
                        </div>
                        <div class="bg-black-lighter p-2 rounded text-center">
                            <div class="text-yellow font-bold">INDICES</div>
                            <div class="text-gray">NAS, SPX, DJI</div>
                        </div>
                    </div>
                </div>

                <!-- Risk Settings -->
                <div class="bg-black-light rounded-xl p-6">
                    <h2 class="text-lg font-semibold flex items-center gap-2 mb-4">
                        <svg class="w-5 h-5 text-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                        </svg>
                        Risk Parameters
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="text-sm text-gray block mb-2">Risk Per Trade</label>
                            <input type="range" id="risk-slider" min="0.5" max="5" step="0.5" value="2" class="w-full accent-yellow">
                            <div class="flex justify-between text-xs text-gray mt-1">
                                <span>0.5%</span>
                                <span class="text-yellow font-bold" id="risk-value">2%</span>
                                <span>5%</span>
                            </div>
                        </div>
                        <div>
                            <label class="text-sm text-gray block mb-2">Minimum R:R Ratio</label>
                            <select id="min-rr" class="w-full bg-black-lighter border border-gray-700 rounded px-3 py-2 text-sm focus:border-yellow focus:outline-none">
                                <option value="1.5">1:1.5</option>
                                <option value="2" selected>1:2</option>
                                <option value="2.5">1:2.5</option>
                                <option value="3">1:3</option>
                            </select>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray">Aggressive Mode</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="aggressive-mode" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-yellow"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Session Info -->
                <div class="bg-black-light rounded-xl p-6">
                    <h2 class="text-lg font-semibold flex items-center gap-2 mb-4">
                        <svg class="w-5 h-5 text-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Trading Sessions
                    </h2>
                    <div class="space-y-2">
                        <div class="flex items-center justify-between p-2 rounded" id="session-sydney">
                            <span class="text-sm">ðŸ‡¦ðŸ‡º Sydney</span>
                            <span class="text-xs text-gray">22:00 - 07:00 GMT</span>
                        </div>
                        <div class="flex items-center justify-between p-2 rounded" id="session-tokyo">
                            <span class="text-sm">ðŸ‡¯ðŸ‡µ Tokyo</span>
                            <span class="text-xs text-gray">00:00 - 09:00 GMT</span>
                        </div>
                        <div class="flex items-center justify-between p-2 rounded" id="session-london">
                            <span class="text-sm">ðŸ‡¬ðŸ‡§ London</span>
                            <span class="text-xs text-gray">08:00 - 17:00 GMT</span>
                        </div>
                        <div class="flex items-center justify-between p-2 rounded" id="session-newyork">
                            <span class="text-sm">ðŸ‡ºðŸ‡¸ New York</span>
                            <span class="text-xs text-gray">13:00 - 22:00 GMT</span>
                        </div>
                    </div>
                </div>

                <!-- AI Engine Status -->
                <div class="bg-black-light rounded-xl p-6">
                    <h2 class="text-lg font-semibold flex items-center gap-2 mb-4">
                        <svg class="w-5 h-5 text-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/>
                        </svg>
                        System Status
                    </h2>
                    <div class="space-y-2 text-sm">
                        <div class="flex items-center justify-between py-2 border-b border-gray-800">
                            <span class="text-gray">Binance API</span>
                            <span class="text-green flex items-center gap-1" id="binance-status">
                                <span class="w-2 h-2 bg-green rounded-full"></span>
                                Connected
                            </span>
                        </div>
                        <div class="flex items-center justify-between py-2 border-b border-gray-800">
                            <span class="text-gray">Forex API</span>
                            <span class="text-green flex items-center gap-1" id="forex-status">
                                <span class="w-2 h-2 bg-green rounded-full"></span>
                                Connected
                            </span>
                        </div>
                        <div class="flex items-center justify-between py-2 border-b border-gray-800">
                            <span class="text-gray">Image Analysis</span>
                            <span class="text-green flex items-center gap-1">
                                <span class="w-2 h-2 bg-green rounded-full"></span>
                                Ready
                            </span>
                        </div>
                        <div class="flex items-center justify-between py-2">
                            <span class="text-gray">OCR Engine</span>
                            <span class="text-green flex items-center gap-1">
                                <span class="w-2 h-2 bg-green rounded-full"></span>
                                Loaded
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Pair Modal -->
    <div id="add-pair-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-black-light rounded-xl p-6 max-w-md w-full slide-in border border-gray-700">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold">Add Favorite Pair</h3>
                <button onclick="closeAddPairModal()" class="text-gray hover:text-white">âœ•</button>
            </div>
            <div class="space-y-3 mb-6">
                <h4 class="text-sm text-gray font-semibold">CRYPTO PAIRS</h4>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="addFavoritePair('BTCUSDT')" class="pair-btn px-3 py-2 text-xs bg-black-lighter rounded hover:bg-yellow hover:text-black transition">BTC/USDT</button>
                    <button onclick="addFavoritePair('ETHUSDT')" class="pair-btn px-3 py-2 text-xs bg-black-lighter rounded hover:bg-yellow hover:text-black transition">ETH/USDT</button>
                    <button onclick="addFavoritePair('BNBUSDT')" class="pair-btn px-3 py-2 text-xs bg-black-lighter rounded hover:bg-yellow hover:text-black transition">BNB/USDT</button>
                    <button onclick="addFavoritePair('SOLUSDT')" class="pair-btn px-3 py-2 text-xs bg-black-lighter rounded hover:bg-yellow hover:text-black transition">SOL/USDT</button>
                </div>
            </div>
            <div class="space-y-3 mb-6">
                <h4 class="text-sm text-gray font-semibold">FOREX PAIRS</h4>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="addFavoritePair('EURUSD')" class="pair-btn px-3 py-2 text-xs bg-black-lighter rounded hover:bg-yellow hover:text-black transition">EUR/USD</button>
                    <button onclick="addFavoritePair('GBPUSD')" class="pair-btn px-3 py-2 text-xs bg-black-lighter rounded hover:bg-yellow hover:text-black transition">GBP/USD</button>
                    <button onclick="addFavoritePair('USDJPY')" class="pair-btn px-3 py-2 text-xs bg-black-lighter rounded hover:bg-yellow hover:text-black transition">USD/JPY</button>
                    <button onclick="addFavoritePair('AUDUSD')" class="pair-btn px-3 py-2 text-xs bg-black-lighter rounded hover:bg-yellow hover:text-black transition">AUD/USD</button>
                </div>
            </div>
            <div class="space-y-3">
                <h4 class="text-sm text-gray font-semibold">METALS & INDICES</h4>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="addFavoritePair('XAUUSD')" class="pair-btn px-3 py-2 text-xs bg-black-lighter rounded hover:bg-yellow hover:text-black transition">XAU/USD</button>
                    <button onclick="addFavoritePair('XAGUSD')" class="pair-btn px-3 py-2 text-xs bg-black-lighter rounded hover:bg-yellow hover:text-black transition">XAG/USD</button>
                    <button onclick="addFavoritePair('NAS100')" class="pair-btn px-3 py-2 text-xs bg-black-lighter rounded hover:bg-yellow hover:text-black transition">NAS100</button>
                    <button onclick="addFavoritePair('US30')" class="pair-btn px-3 py-2 text-xs bg-black-lighter rounded hover:bg-yellow hover:text-black transition">US30</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Live Signal Panel (appears when pair clicked) -->
    <div id="live-signal-panel" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-black-light rounded-xl p-6 max-w-2xl w-full slide-in border border-yellow max-h-96 overflow-y-auto scrollbar-custom">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <span id="signal-pair-name" class="text-yellow">BTC/USDT</span>
                    <span id="signal-timeframe" class="text-sm text-gray bg-black-lighter px-2 py-1 rounded">--</span>
                </h3>
                <button onclick="closeLiveSignalPanel()" class="text-gray hover:text-white text-2xl">âœ•</button>
            </div>
            
            <div id="live-signal-content" class="space-y-4">
                <!-- Signal will be dynamically inserted -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="border-t border-gray-800 mt-8 py-6">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-yellow flex items-center justify-center rounded">
                        <svg class="w-4 h-4 text-black" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                    </div>
                    <span class="text-sm text-gray">Â© 2024 SMART-KORAFX. Professional AI Trading Analysis.</span>
                </div>
                <div class="flex items-center gap-4 text-xs text-gray">
                    <span class="text-yellow">Real-time Data</span>
                    <span>|</span>
                    <span>Risk Disclaimer</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // ============================================
        // SMART-KORAFX AI TRADING ANALYST ENGINE
        // ============================================

        // Global State
        const state = {
            liveChart: null,
            currentSymbol: 'BTCUSDT',
            marketData: {},
            analysisHistory: [],
            isAnalyzing: false,
            favoritePairs: ['BTCUSDT', 'ETHUSDT', 'EURUSD', 'XAUUSD', 'GBPUSD'],
            detectedTimeframe: null
        };

        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ðŸš€ SMART-KORAFX Initializing...');
            
            loadFavoritePairs();
            setupFileUpload();
            updateTime();
            setInterval(updateTime, 1000);
            
            await fetchAllMarketData();
            setInterval(fetchAllMarketData, 10000);
            
            initializeChart();
            setupRiskSlider();
            updateTradingSessions();
            setInterval(updateTradingSessions, 60000);
            
            console.log('âœ… SMART-KORAFX Ready');
        });

        // Market Data Functions
        async function fetchAllMarketData() {
            try {
                await Promise.all([fetchCryptoData(), fetchForexData()]);
                updateMarketDisplay();
                updateApiStatus(true);
            } catch (error) {
                console.error('Market data fetch error:', error);
                updateApiStatus(false);
            }
        }

        async function fetchCryptoData() {
            try {
                const symbols = ['BTCUSDT', 'ETHUSDT', 'BNBUSDT', 'SOLUSDT', 'PAXGUSDT'];
                const response = await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbols=${JSON.stringify(symbols)}`);
                const data = await response.json();

                if (!Array.isArray(data)) throw new Error('Unexpected response');

                data.forEach(ticker => {
                    state.marketData[ticker.symbol] = {
                        price: parseFloat(ticker.lastPrice),
                        change: parseFloat(ticker.priceChangePercent),
                        high: parseFloat(ticker.highPrice),
                        low: parseFloat(ticker.lowPrice),
                        volume: parseFloat(ticker.volume)
                    };
                });

                if (state.marketData.PAXGUSDT) {
                    state.marketData.XAUUSD = {...state.marketData.PAXGUSDT};
                }

                if (state.marketData.BTCUSDT) {
                    document.getElementById('btc-price').textContent = '$' + formatPrice(state.marketData.BTCUSDT.price);
                    updateChangeDisplay('btc-change', state.marketData.BTCUSDT.change);
                }
                if (state.marketData.ETHUSDT) {
                    document.getElementById('eth-price').textContent = '$' + formatPrice(state.marketData.ETHUSDT.price);
                    updateChangeDisplay('eth-change', state.marketData.ETHUSDT.change);
                }
                if (state.marketData.XAUUSD) {
                    document.getElementById('gold-price').textContent = '$' + formatPrice(state.marketData.XAUUSD.price);
                    updateChangeDisplay('gold-change', state.marketData.XAUUSD.change);
                }

                document.getElementById('binance-status').innerHTML = '<span class="w-2 h-2 bg-green rounded-full"></span> Connected';
            } catch (error) {
                console.error('Crypto API error:', error);
                document.getElementById('binance-status').innerHTML = '<span class="w-2 h-2 bg-red rounded-full"></span> Error';
            }
        }

        async function fetchForexData() {
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const data = await response.json();

                if (!data.rates) throw new Error('No forex rates');

                const eurUsd = parseFloat((1 / data.rates.EUR).toFixed(5));
                state.marketData.EURUSD = { price: eurUsd, change: 0, high: null, low: null, volume: null };
                document.getElementById('eur-price').textContent = eurUsd.toFixed(5);

                const gbpUsd = parseFloat((1 / data.rates.GBP).toFixed(5));
                state.marketData.GBPUSD = { price: gbpUsd, change: 0, high: null, low: null, volume: null };
                document.getElementById('gbp-price').textContent = gbpUsd.toFixed(5);

                document.getElementById('forex-status').innerHTML = '<span class="w-2 h-2 bg-green rounded-full"></span> Connected';
            } catch (error) {
                console.error('Forex API error:', error);
                document.getElementById('forex-status').innerHTML = '<span class="w-2 h-2 bg-red rounded-full"></span> Error';
            }
        }

        function formatPrice(price) {
            if (price >= 1000) return price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            if (price >= 1) return price.toFixed(4);
            return price.toFixed(6);
        }

        function updateChangeDisplay(elementId, change) {
            const el = document.getElementById(elementId);
            const isPositive = change >= 0;
            el.textContent = (isPositive ? '+' : '') + change.toFixed(2) + '%';
            el.className = isPositive ? 'text-xs text-green' : 'text-xs text-red';
        }

        function updateApiStatus(connected) {
            const statusEl = document.getElementById('api-status');
            const textEl = document.getElementById('api-status-text');
            if (connected) {
                statusEl.className = 'w-2 h-2 bg-green rounded-full pulse';
                textEl.textContent = 'LIVE DATA';
            } else {
                statusEl.className = 'w-2 h-2 bg-red rounded-full';
                textEl.textContent = 'OFFLINE';
            }
        }

        function updateMarketDisplay() {
            const container = document.getElementById('live-markets');
            let html = '';
            
            state.favoritePairs.forEach(symbol => {
                const data = state.marketData[symbol];
                if (data) {
                    const isPositive = data.change >= 0;
                    const displayName = symbol.replace('USDT', '').replace('USD', '');
                    
                    html += `
                        <div onclick="generateLiveSignal('${symbol}')" class="stat-card rounded-lg p-3 flex items-center justify-between cursor-pointer hover:bg-opacity-80 transition">
                            <div class="flex items-center gap-3 flex-1">
                                <div class="w-8 h-8 bg-yellow bg-opacity-20 rounded flex items-center justify-center text-yellow text-sm">â—</div>
                                <div>
                                    <p class="text-sm font-medium">${displayName}</p>
                                    <p class="text-xs text-gray">${symbol}</p>
                                </div>
                            </div>
                            <div class="text-right flex items-center gap-4">
                                <div>
                                    <p class="text-sm font-bold mono">${formatPrice(data.price)}</p>
                                    <p class="text-xs ${isPositive ? 'text-green' : 'text-red'}">${isPositive ? 'â†‘' : 'â†“'} ${Math.abs(data.change).toFixed(2)}%</p>
                                </div>
                                <button onclick="event.stopPropagation(); removeFavoritePair('${symbol}')" class="text-gray hover:text-red">âœ•</button>
                            </div>
                        </div>
                    `;
                }
            });
            
            container.innerHTML = html || '<div class="text-center text-gray text-sm py-4">No pairs selected</div>';
        }

        function setupFileUpload() {
            const uploadZone = document.getElementById('upload-zone');
            const fileInput = document.getElementById('file-input');

            uploadZone.addEventListener('click', () => fileInput.click());
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });
            uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                if (e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]);
            });
            fileInput.addEventListener('change', (e) => {
                if (e.target.files[0]) handleFile(e.target.files[0]);
            });
        }

        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('Please upload an image');
                return;
            }
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('chart-preview').src = e.target.result;
                document.getElementById('upload-content').classList.add('hidden');
                document.getElementById('preview-content').classList.remove('hidden');
                document.getElementById('file-name').textContent = file.name;
            };
            reader.readAsDataURL(file);
        }

        function resetUpload() {
            document.getElementById('upload-content').classList.remove('hidden');
            document.getElementById('preview-content').classList.add('hidden');
            document.getElementById('analysis-panel').classList.add('hidden');
            document.getElementById('file-input').value = '';
        }

        function updateTime() {
            document.getElementById('current-time').textContent = new Date().toUTCString().slice(0, -4);
        }

        function setupRiskSlider() {
            const slider = document.getElementById('risk-slider');
            slider.addEventListener('input', (e) => {
                document.getElementById('risk-value').textContent = e.target.value + '%';
            });
        }

        function updateTradingSessions() {
            const hour = new Date().getUTCHours();
            const sessions = {
                'session-sydney': hour >= 22 || hour < 7,
                'session-tokyo': hour >= 0 && hour < 9,
                'session-london': hour >= 8 && hour < 17,
                'session-newyork': hour >= 13 && hour < 22
            };

            for (const [id, isActive] of Object.entries(sessions)) {
                const el = document.getElementById(id);
                if (isActive) {
                    el.classList.add('bg-yellow', 'bg-opacity-20');
                } else {
                    el.classList.remove('bg-yellow', 'bg-opacity-20');
                }
            }
        }

        async function initializeChart() {
            const ctx = document.getElementById('liveChart').getContext('2d');
            const { series } = await fetchKlines('BTCUSDT', '1h', 80);
            const labels = series.map(k => new Date(k[0]).toLocaleTimeString());
            const prices = series.map(k => parseFloat(k[4]));

            state.liveChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'BTCUSDT',
                        data: prices,
                        borderColor: '#FFD700',
                        backgroundColor: 'rgba(255, 215, 0, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { display: false }, y: { position: 'right' } }
                }
            });
        }

        async function fetchKlines(symbol, interval = '1h', limit = 80) {
            try {
                const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`);
                return await res.json();
            } catch (e) {
                console.error('Klines error:', e);
                return [];
            }
        }

        async function switchChartSymbol(symbol) {
            state.currentSymbol = symbol;
            document.querySelectorAll('.chart-btn').forEach(b => {
                b.classList.remove('bg-yellow', 'text-black');
                b.classList.add('bg-black-lighter');
            });
            event.target.classList.add('bg-yellow', 'text-black');
            event.target.classList.remove('bg-black-lighter');
            document.getElementById('chart-symbol-display').textContent = symbol;
        }

        function openAddPairModal() {
            document.getElementById('add-pair-modal').classList.remove('hidden');
        }

        function closeAddPairModal() {
            document.getElementById('add-pair-modal').classList.add('hidden');
        }

        function addFavoritePair(symbol) {
            if (!state.favoritePairs.includes(symbol)) {
                state.favoritePairs.push(symbol);
                saveFavoritePairs();
                updateMarketDisplay();
                closeAddPairModal();
            }
        }

        function removeFavoritePair(symbol) {
            state.favoritePairs = state.favoritePairs.filter(s => s !== symbol);
            saveFavoritePairs();
            updateMarketDisplay();
        }

        function saveFavoritePairs() {
            localStorage.setItem('smartkorafx_favorite_pairs', JSON.stringify(state.favoritePairs));
        }

        function loadFavoritePairs() {
            const saved = localStorage.getItem('smartkorafx_favorite_pairs');
            if (saved) state.favoritePairs = JSON.parse(saved);
        }

        async function generateLiveSignal(symbol) {
            alert(`Signal generation for ${symbol} - Demo mode`);
        }

        function closeLiveSignalPanel() {
            document.getElementById('live-signal-panel').classList.add('hidden');
        }
    </script>
</body>
</html>
